{
  "cells": [
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "view-in-github",
        "colab_type": "text"
      },
      "source": [
        "<a href=\"https://colab.research.google.com/github/KhansaKhanam/PhysiologicalAgeAnalysis/blob/main/PA_part1.Rmd\" target=\"_parent\"><img src=\"https://colab.research.google.com/assets/colab-badge.svg\" alt=\"Open In Colab\"/></a>"
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "# # Run this on Python\n",
        "# from google.colab import drive\n",
        "# drive.mount('/content/drive')"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "LcF02_BX9uZr",
        "outputId": "dd46067e-4d2b-43a8-ca72-ddca40b4f6b3"
      },
      "execution_count": 1,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Mounted at /content/drive\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "execution_count": 1,
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "7P3fCO_kwT2A",
        "outputId": "bb473815-a8a1-4958-eca3-0ca0eda2fc5e"
      },
      "outputs": [
        {
          "output_type": "stream",
          "name": "stderr",
          "text": [
            "Installing package into ‘/usr/local/lib/R/site-library’\n",
            "(as ‘lib’ is unspecified)\n",
            "\n",
            "Installing package into ‘/usr/local/lib/R/site-library’\n",
            "(as ‘lib’ is unspecified)\n",
            "\n",
            "also installing the dependency ‘plyr’\n",
            "\n",
            "\n",
            "Installing package into ‘/usr/local/lib/R/site-library’\n",
            "(as ‘lib’ is unspecified)\n",
            "\n",
            "Installing package into ‘/usr/local/lib/R/site-library’\n",
            "(as ‘lib’ is unspecified)\n",
            "\n",
            "Installing package into ‘/usr/local/lib/R/site-library’\n",
            "(as ‘lib’ is unspecified)\n",
            "\n",
            "Installing package into ‘/usr/local/lib/R/site-library’\n",
            "(as ‘lib’ is unspecified)\n",
            "\n"
          ]
        }
      ],
      "source": [
        "install.packages(\"tidyverse\")\n",
        "install.packages(\"nhanesA\")\n",
        "install.packages(\"readr\")\n",
        "install.packages(\"dplyr\")\n",
        "install.packages(\"ggplot2\")\n",
        "install.packages(\"tidyr\")"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": 2,
      "metadata": {
        "id": "o5Gf3u0-7mIf",
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "outputId": "edbe1873-b78f-4e20-9332-41a9e0ef9eb6"
      },
      "outputs": [
        {
          "output_type": "stream",
          "name": "stderr",
          "text": [
            "\n",
            "Attaching package: ‘dplyr’\n",
            "\n",
            "\n",
            "The following objects are masked from ‘package:stats’:\n",
            "\n",
            "    filter, lag\n",
            "\n",
            "\n",
            "The following objects are masked from ‘package:base’:\n",
            "\n",
            "    intersect, setdiff, setequal, union\n",
            "\n",
            "\n"
          ]
        }
      ],
      "source": [
        "library(dplyr)\n",
        "library(readr)\n",
        "library(nhanesA)\n",
        "library(ggplot2)\n",
        "library(purrr)"
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "source(\"/content/drive/MyDrive/PA_analysis/MuraliUtilitiesforNHANES.R\")"
      ],
      "metadata": {
        "id": "7-684nzL8bry"
      },
      "execution_count": 3,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "nhanesdata <- \"wwwn.cdc.gov/nchs/nhanes/\"\n",
        "yrs_nhanes <- c(\"2009-2010\",\"2011-2012\",\"2013-2014\",\"2015-2016\",\"2017-2018\")\n",
        "ltrs <- c(\"F\",\"G\",\"H\",\"I\",\"J\")\n",
        "groupsnhanes <- c(\"DEMO\",\"DIET\",\"EXAM\",\"LAB\",\"Q\")"
      ],
      "metadata": {
        "id": "-NCut_nx-9Y9"
      },
      "execution_count": 4,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "select_cols1 <- c(\"SEQN\", \"SDDSRVYR\",\"RIAGENDR\",\"RIDAGEYR\",\"RIDRETH1\", \"RIDRETH3\",\"WTINT2YR\", \"WTMEC2YR\", \"RIDEXMON\", \"DR1TKCAL\", \"DR2TKCAL\",\"DR1TTFAT\",\"DR2TTFAT\", \"BMXWT\",\"BMXHT\",\"BMXBMI\",\"BMXWAIST\", \"URXUMA\",\"URXUCR\",\"URDACT\", \"LBXRBCSI\",\"LBXWBCSI\",\"LBXPLTSI\",\"LBDLYMNO\",\"LBDMONO\",\"LBDNENO\",\"LBXHGB\",\"LBXHCT\", \"URDFLOW1\",\"URDFLOW2\",\"URDFLOW3\", \"LBXSAL\",\"LBXSATSI\",\"LBXSASSI\",\"LBXSAPSI\",\"LBXSCR\",\"LBXSGTSI\",\"LBXSTB\", \"LBXHA\",\"LBXHBC\",\"LBDHBG\",\"LBXHCR\",\"LBDHEG\",\"LBDHEM\",\"LBXHE1\",\"LBXHE2\")\n",
        "select_cols2 <- c(\"DXDTOFAT\",\"DXDTOLE\",\"DXDTOBMC\",\"DXDTOPF\")  # DEXA body fat\n",
        "select_cols3 <- c(\"LBXHBS\") # Hepatitis B Surface antigen missing in F\n",
        "select_cols4 <- c(\"DUQ240\",\"DUQ250\",\"DUQ290\",\"DUQ300\",\"DUQ310Q\",\"DUQ310U\",\"DUQ370\",\"DUQ380B\") # Drug use\n",
        "select_cols5 <- c(\"KIQ022\",\"KIQ025\")\n",
        "select_cols6 <- c(\"DIQ010\",\"DIQ160\",\"DIQ050\",\"DIQ070\")\n",
        "select_cols7 <- c(\"LBXIN\",\"LBXGLU\",\"LBXGH\",\"LBXTR\",\"LBXTC\",\"LBDLDL\",\"LBDHDD\")\n",
        "select_cols8 <- c(\"BPXSY1\",\"BPXSY2\",\"BPXSY3\",\"BPXSY4\",\"BPXDI1\",\"BPXDI2\",\"BPXDI3\",\"BPXDI4\")\n",
        "select_cols9 <- c(\"MCQ160L\",\"MCQ170L\",\"MCQ160B\",\"MCQ160C\",\"MCQ160D\",\"MCQ160E\",\"MCQ160F\")\n",
        "select_cols10 <- c(\"LBXACR\", \"LBXGLY\", \"URXAMU\", \"URXMU1\", \"URXMX1\", \"URXMU5\", \"URXMX5\", \"LBXCOT\", \"LBXTST\", \"LBXEST\", \"LBXHCT_SMQ\")\n",
        "select_cols11 <- c(\"SSKLOTH\",\"SSSNFL\",\"LBDAPBSI\",\"SSAGP\",\"LBXHSCRP\")\n",
        "# select_cols12 <- c(\"SEQN\",\"ELIGSTAT\",\"MORTSTAT\",\"UCOD_LEADING\",\"DIABETES\",\"HYPERTEN\",\"PERMTH_INT\",\"PERMTH_EXM\")\n",
        "\n",
        "selected_columns <-c(select_cols1,select_cols2,select_cols3,select_cols4,select_cols5,select_cols6,select_cols7,select_cols8,select_cols9,select_cols10,select_cols11)"
      ],
      "metadata": {
        "id": "KuhgoGGl-_XU"
      },
      "execution_count": 5,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "mortality <- function(files_mort){\n",
        "  for (year in names(files_mort)){\n",
        "    assign(paste0(\"mort_\",year), read_fwf(file=files_mort[[year]],\n",
        "                                          col_types = \"iiiiiiii\",\n",
        "                                          fwf_cols(SEQN = c(1,6),\n",
        "                                                   ELIGSTAT = c(15,15),\n",
        "                                                   MORTSTAT = c(16,16),\n",
        "                                                   UCOD_LEADING = c(17,19),\n",
        "                                                   DIABETES = c(20,20),\n",
        "                                                   HYPERTEN = c(21,21),\n",
        "                                                   PERMTH_INT = c(43,45),\n",
        "                                                   PERMTH_EXM = c(46,48)\n",
        "                                          ),\n",
        "                                          na = c(\"\", \".\")\n",
        "    ),envir = .GlobalEnv)\n",
        "  }\n",
        "}"
      ],
      "metadata": {
        "id": "hIBJIbtV_EZ3"
      },
      "execution_count": 6,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "files_mort <- list(\"2009\"=\"/content/drive/MyDrive/PA_analysis/NHANES_2009_2010_MORT_2019_PUBLIC.dat\",\n",
        "                   \"2011\"=\"/content/drive/MyDrive/PA_analysis/NHANES_2011_2012_MORT_2019_PUBLIC.dat\",\n",
        "                   \"2013\"=\"/content/drive/MyDrive/PA_analysis/NHANES_2013_2014_MORT_2019_PUBLIC.dat\",\n",
        "                   \"2015\"=\"/content/drive/MyDrive/PA_analysis/NHANES_2015_2016_MORT_2019_PUBLIC.dat\",\n",
        "                   \"2017\"=\"/content/drive/MyDrive/PA_analysis/NHANES_2017_2018_MORT_2019_PUBLIC.dat\")\n",
        "\n",
        "mortality(files_mort)"
      ],
      "metadata": {
        "id": "87kZe64c_Kt0"
      },
      "execution_count": 7,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "hep_2009 <- as.data.frame(matrix(nrow = 0, ncol = 5))\n",
        "colnames(hep_2009) <- c(\"SEQN\", \"HEQ010\", \"HEQ020\", \"HEQ030\", \"HEQ040\")\n",
        "\n",
        "hep_2011 <- as.data.frame(matrix(nrow = 0, ncol = 5))\n",
        "colnames(hep_2011) <- c(\"SEQN\", \"HEQ010\", \"HEQ020\", \"HEQ030\", \"HEQ040\")"
      ],
      "metadata": {
        "id": "NKzJSkM3_PSO"
      },
      "execution_count": 8,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "df_list_F <- list(nhanes('DEMO_F', translate=FALSE),\n",
        "                  nhanes('DR1TOT_F', translate=FALSE),\n",
        "                  nhanes('DR2TOT_F', translate=FALSE),\n",
        "                  nhanes('BMX_F', translate=FALSE),\n",
        "                  nhanes('ALB_CR_F', translate=FALSE),\n",
        "                  nhanes('CBC_F', translate=FALSE),\n",
        "                  nhanes('UCFLOW_F', translate=FALSE),\n",
        "                  nhanes('BIOPRO_F', translate=FALSE),\n",
        "                  nhanes('HEPA_F', translate=FALSE),\n",
        "                  nhanes('HEPBD_F', translate=FALSE),\n",
        "                  nhanes('HEPC_F', translate=FALSE),\n",
        "                  nhanes('HEPE_F', translate=FALSE),\n",
        "                  nhanes('HSV_F', translate=FALSE),\n",
        "                  nhanes('HIV_F', translate=FALSE),\n",
        "                  nhanes(\"MCQ_F\", translate=FALSE),\n",
        "                  nhanes(\"KIQ_U_F\", translate=FALSE),\n",
        "                  nhanes(\"DIQ_F\", translate=FALSE),\n",
        "                  nhanes(\"DUQ_F\", translate=FALSE),\n",
        "                  nhanes(\"TCHOL_F\", translate=FALSE),\n",
        "                  nhanes(\"TRIGLY_F\", translate=FALSE),\n",
        "                  nhanes(\"HDL_F\", translate=FALSE),\n",
        "                  nhanes(\"GHB_F\", translate=FALSE),\n",
        "                  nhanes(\"GLU_F\", translate=FALSE),\n",
        "                  nhanes(\"BPX_F\", translate=FALSE),\n",
        "                  nhanes(\"APOB_F\", translate=FALSE),\n",
        "                  nhanes(\"SSKL_F\", translate=FALSE)\n",
        "                  )"
      ],
      "metadata": {
        "id": "zd4Rrssy_gY4"
      },
      "execution_count": 9,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "install.packages(c(\"purrr\",\"dplyr\"))"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/"
        },
        "id": "NHd57wlk_kud",
        "outputId": "6fe3afe1-72b6-455f-fcef-051de6c48c56"
      },
      "execution_count": 10,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stderr",
          "text": [
            "Installing packages into ‘/usr/local/lib/R/site-library’\n",
            "(as ‘lib’ is unspecified)\n",
            "\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "library(purrr)"
      ],
      "metadata": {
        "id": "8J1FHfeQ_tRd"
      },
      "execution_count": 11,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "allmerge_F<- df_list_F %>% reduce(full_join, by ='SEQN')\n",
        "allmerge_F<- allmerge_F %>% mutate(RIDRETH3=recode(RIDRETH1,'1'='1','2'='2','3'='3','4'='4','5'='7',.default=NA_character_))"
      ],
      "metadata": {
        "id": "GQiKF6gA_06w"
      },
      "execution_count": 12,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "allmerge_F$LBXHBS <- NA\n",
        "allmerge_F$DXDTOFAT <- NA\n",
        "allmerge_F$DXDTOLE <- NA\n",
        "allmerge_F$DXDTOBMC <- NA\n",
        "allmerge_F$DXDTOPF <- NA\n",
        "allmerge_F$SSSNFL <- NA\n",
        "allmerge_F$SSAGP <- NA\n",
        "allmerge_F$LBXHSCRP <- NA\n",
        "\n",
        "allmerge_F$LBXACR <- NA\n",
        "allmerge_F$LBXGLY <- NA\n",
        "allmerge_F$URXAMU <- NA\n",
        "allmerge_F$URXMU1 <- NA\n",
        "allmerge_F$URXMX1 <- NA\n",
        "allmerge_F$URXMU5 <- NA\n",
        "allmerge_F$URXMX5 <- NA\n",
        "allmerge_F$LBXTST <- NA\n",
        "allmerge_F$LBXEST <- NA\n",
        "allmerge_F$LBXCOT <- NA\n",
        "allmerge_F$LBXHCT_SMQ <- NA"
      ],
      "metadata": {
        "id": "Vm_VjDde_4NV"
      },
      "execution_count": 13,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "selected_allmerge_F <- allmerge_F[selected_columns]"
      ],
      "metadata": {
        "id": "iOg1u6OP_8nj"
      },
      "execution_count": 14,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "selected_allmerge_F <- selected_allmerge_F %>% left_join(mort_2009, by = \"SEQN\")"
      ],
      "metadata": {
        "id": "TL052XO-_-yi"
      },
      "execution_count": 15,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "df_list_G <- list(nhanes('DEMO_G', translate=FALSE),\n",
        "                  nhanes('DR1TOT_G', translate=FALSE),\n",
        "                  nhanes('DR2TOT_G', translate=FALSE),\n",
        "                  nhanes('BMX_G', translate=FALSE),\n",
        "                  nhanes('DXX_G', translate=FALSE),\n",
        "                  nhanes('ALB_CR_G', translate=FALSE),\n",
        "                  nhanes('CBC_G', translate=FALSE),\n",
        "                  nhanes('UCFLOW_G', translate=FALSE),\n",
        "                  nhanes('BIOPRO_G', translate=FALSE),\n",
        "                  nhanes('HEPA_G', translate=FALSE),\n",
        "                  nhanes('HEPBD_G', translate=FALSE),\n",
        "                  nhanes('HEPB_S_G', translate=FALSE),\n",
        "                  nhanes('HEPC_G', translate=FALSE),\n",
        "                  nhanes('HEPE_G', translate=FALSE),\n",
        "                  nhanes('HSV_G', translate=FALSE),\n",
        "                  nhanes('HIV_G', translate=FALSE),\n",
        "                  nhanes(\"MCQ_G\", translate=FALSE),\n",
        "                  nhanes(\"KIQ_U_G\", translate=FALSE),\n",
        "                  nhanes(\"DIQ_G\", translate=FALSE),\n",
        "                  nhanes(\"DUQ_G\", translate=FALSE),\n",
        "                  nhanes(\"TCHOL_G\", translate=FALSE),\n",
        "                  nhanes(\"TRIGLY_G\", translate=FALSE),\n",
        "                  nhanes(\"HDL_G\", translate=FALSE),\n",
        "                  nhanes(\"GHB_G\", translate=FALSE),\n",
        "                  nhanes(\"GLU_G\", translate=FALSE),\n",
        "                  nhanes(\"BPX_G\", translate=FALSE),\n",
        "                  nhanes(\"APOB_G\", translate=FALSE),\n",
        "                  nhanes(\"CAFE_G\", translate=FALSE),\n",
        "                  nhanes(\"SSKL_G\", translate=FALSE)\n",
        "                  )"
      ],
      "metadata": {
        "id": "EZvN0EqUAAQy"
      },
      "execution_count": 16,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "allmerge_G<- df_list_G %>% reduce(full_join, by='SEQN')\n",
        "allmerge_G$SSSNFL <- NA\n",
        "allmerge_G$SSAGP <- NA\n",
        "allmerge_G$LBXHSCRP <- NA\n",
        "\n",
        "allmerge_G$LBXACR <- NA\n",
        "allmerge_G$LBXGLY <- NA\n",
        "allmerge_G$LBXTST <- NA\n",
        "allmerge_G$LBXEST <- NA\n",
        "allmerge_G$LBXCOT <- NA\n",
        "allmerge_G$LBXHCT_SMQ <- NA\n",
        "\n",
        "selected_allmerge_G <- allmerge_G[selected_columns]"
      ],
      "metadata": {
        "id": "qkPKpmqZAD-N"
      },
      "execution_count": 17,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "selected_allmerge_G <- selected_allmerge_G %>% left_join(mort_2011, by = \"SEQN\")"
      ],
      "metadata": {
        "id": "uTsYzR1wAXKe"
      },
      "execution_count": 18,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "df_list_H <- list(nhanes('DEMO_H', translate=FALSE),\n",
        "                  nhanes('DR1TOT_H', translate=FALSE),\n",
        "                  nhanes('DR2TOT_H', translate=FALSE),\n",
        "                  nhanes('BMX_H', translate=FALSE),\n",
        "                  nhanes('DXX_H', translate=FALSE),\n",
        "                  nhanes('ALB_CR_H', translate=FALSE),\n",
        "                  nhanes('CBC_H', translate=FALSE),\n",
        "                  nhanes('UCFLOW_H', translate=FALSE),\n",
        "                  nhanes('BIOPRO_H', translate=FALSE),\n",
        "                  nhanes('HEPA_H', translate=FALSE),\n",
        "                  nhanes('HEPBD_H', translate=FALSE),\n",
        "                  nhanes('HEPB_S_H', translate=FALSE),\n",
        "                  nhanes('HEPC_H', translate=FALSE),\n",
        "                  nhanes('HEPE_H', translate=FALSE),\n",
        "                  nhanes('HSV_H', translate=FALSE),\n",
        "                  nhanes('HIV_H', translate=FALSE),\n",
        "                  nhanes(\"MCQ_H\", translate=FALSE),\n",
        "                  nhanes(\"KIQ_U_H\", translate=FALSE),\n",
        "                  nhanes(\"DIQ_H\", translate=FALSE),\n",
        "                  nhanes(\"DUQ_H\", translate=FALSE),\n",
        "                  nhanes(\"TCHOL_H\", translate=FALSE),\n",
        "                  nhanes(\"TRIGLY_H\", translate=FALSE),\n",
        "                  nhanes(\"HDL_H\", translate=FALSE),\n",
        "                  nhanes(\"GHB_H\", translate=FALSE),\n",
        "                  nhanes(\"GLU_H\", translate=FALSE),\n",
        "                  nhanes(\"INS_H\", translate=FALSE),\n",
        "                  nhanes(\"BPX_H\", translate=FALSE),\n",
        "                  nhanes(\"APOB_H\", translate=FALSE),\n",
        "                  nhanes(\"SSKL_H\", translate=FALSE),\n",
        "                  nhanes(\"SSSNFL_H\", translate=FALSE),\n",
        "                  nhanes(\"AMDGYD_H\", translate=FALSE),\n",
        "                  nhanes(\"TST_H\", translate=FALSE),\n",
        "                  nhanes(\"CAFE_H\", translate=FALSE),\n",
        "                  nhanes(\"COT_H\", translate = FALSE)\n",
        "                  %>% select(SEQN, LBXCOT, LBXHCT)\n",
        "                  %>% rename(LBXHCT_SMQ = LBXHCT)\n",
        ")"
      ],
      "metadata": {
        "id": "3irjXeItAZJ6"
      },
      "execution_count": 19,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "allmerge_H<- df_list_H %>% reduce(full_join, by='SEQN')\n",
        "\n",
        "allmerge_H$SSAGP <- NA\n",
        "allmerge_H$LBXHSCRP <- NA\n",
        "\n",
        "selected_allmerge_H <- allmerge_H[selected_columns]"
      ],
      "metadata": {
        "id": "t3qr7fDSAd_O"
      },
      "execution_count": 20,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "selected_allmerge_H <- selected_allmerge_H %>% left_join(mort_2013, by = \"SEQN\")"
      ],
      "metadata": {
        "id": "EZX3kGFzAtOJ"
      },
      "execution_count": 21,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "df_list_I <- list(nhanes('DEMO_I', translate=FALSE),\n",
        "                  nhanes('DR1TOT_I', translate=FALSE),\n",
        "                  nhanes('DR2TOT_I', translate=FALSE),\n",
        "                  nhanes('BMX_I', translate=FALSE),\n",
        "                  nhanes('DXX_I', translate=FALSE),\n",
        "                  nhanes('ALB_CR_I', translate=FALSE),\n",
        "                  nhanes('CBC_I', translate=FALSE),\n",
        "                  nhanes('UCFLOW_I', translate=FALSE),\n",
        "                  nhanes('BIOPRO_I', translate=FALSE),\n",
        "                  nhanes('HEPA_I', translate=FALSE),\n",
        "                  nhanes('HEPBD_I', translate=FALSE),\n",
        "                  nhanes('HEPB_S_I', translate=FALSE),\n",
        "                  nhanes('HEPC_I', translate=FALSE),\n",
        "                  nhanes('HEPE_I', translate=FALSE),\n",
        "                  nhanes('HSV_I', translate=FALSE),\n",
        "                  nhanes('HIV_I', translate=FALSE),\n",
        "                  nhanes(\"MCQ_I\", translate=FALSE),\n",
        "                  nhanes(\"KIQ_U_I\", translate=FALSE),\n",
        "                  nhanes(\"DIQ_I\", translate=FALSE),\n",
        "                  nhanes(\"DUQ_I\", translate=FALSE),\n",
        "                  nhanes(\"TCHOL_I\", translate=FALSE),\n",
        "                  nhanes(\"TRIGLY_I\", translate=FALSE),\n",
        "                  nhanes(\"HDL_I\", translate=FALSE),\n",
        "                  nhanes(\"GHB_I\", translate=FALSE),\n",
        "                  nhanes(\"GLU_I\", translate=FALSE),\n",
        "                  nhanes(\"INS_I\", translate=FALSE),\n",
        "                  nhanes(\"BPX_I\", translate=FALSE),\n",
        "                  nhanes(\"APOB_I\", translate=FALSE),\n",
        "                  nhanes(\"SSKL_I\", translate=FALSE),\n",
        "                  nhanes(\"SSAGP_I\", translate=FALSE),\n",
        "                  nhanes(\"HSCRP_I\", translate=FALSE),\n",
        "                  nhanes(\"TST_I\", translate=FALSE),\n",
        "                  nhanes(\"COT_I\", translate = FALSE)\n",
        "                  %>% select(SEQN, LBXCOT, LBXHCT)\n",
        "                  %>% rename(LBXHCT_SMQ = LBXHCT)\n",
        ")"
      ],
      "metadata": {
        "id": "gozGkOIUAvIh"
      },
      "execution_count": 22,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "allmerge_I<- df_list_I %>% reduce(full_join, by='SEQN')\n",
        "allmerge_I$SSSNFL <- NA\n",
        "\n",
        "allmerge_I$LBXACR <- NA\n",
        "allmerge_I$LBXGLY <- NA\n",
        "allmerge_I$URXAMU <- NA\n",
        "allmerge_I$URXMU1 <- NA\n",
        "allmerge_I$URXMX1 <- NA\n",
        "allmerge_I$URXMU5 <- NA\n",
        "allmerge_I$URXMX5 <- NA\n",
        "\n",
        "selected_allmerge_I<- allmerge_I[selected_columns]"
      ],
      "metadata": {
        "id": "Vy2O8vJrAxjf"
      },
      "execution_count": 23,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "selected_allmerge_I <- selected_allmerge_I %>% left_join(mort_2015, by = \"SEQN\")"
      ],
      "metadata": {
        "id": "ueJYTFghAz3g"
      },
      "execution_count": 24,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "df_list_J <- list(nhanes('DEMO_J', translate=FALSE),\n",
        "                  nhanes('DR1TOT_J', translate=FALSE),\n",
        "                  nhanes('DR2TOT_J', translate=FALSE),\n",
        "                  nhanes('BMX_J', translate=FALSE),\n",
        "                  nhanes('DXX_J', translate=FALSE),\n",
        "                  nhanes('ALB_CR_J', translate=FALSE),\n",
        "                  nhanes('CBC_J', translate=FALSE),\n",
        "                  nhanes('UCFLOW_J', translate=FALSE),\n",
        "                  nhanes('BIOPRO_J', translate=FALSE),\n",
        "                  nhanes('HEPA_J', translate=FALSE),\n",
        "                  nhanes('HEPBD_J', translate=FALSE),\n",
        "                  nhanes('HEPB_S_J', translate=FALSE),\n",
        "                  nhanes('HEPE_J', translate=FALSE),\n",
        "                  nhanes('HIV_J', translate=FALSE),\n",
        "                  nhanes(\"MCQ_J\", translate=FALSE),\n",
        "                  nhanes(\"KIQ_U_J\", translate=FALSE),\n",
        "                  nhanes(\"DIQ_J\", translate=FALSE),\n",
        "                  nhanes(\"DUQ_J\", translate=FALSE),\n",
        "                  nhanes(\"TCHOL_J\", translate=FALSE),\n",
        "                  nhanes(\"TRIGLY_J\", translate=FALSE),\n",
        "                  nhanes(\"HDL_J\", translate=FALSE),\n",
        "                  nhanes(\"GHB_J\", translate=FALSE),\n",
        "                  nhanes(\"GLU_J\", translate=FALSE),\n",
        "                  nhanes(\"INS_J\", translate=FALSE),\n",
        "                  nhanes(\"BPX_J\", translate=FALSE),\n",
        "                  nhanes(\"SSAGP_J\", translate=FALSE),\n",
        "                  nhanes(\"HSCRP_J\", translate=FALSE)\n",
        "                  )"
      ],
      "metadata": {
        "id": "xNNvrjsHA7-2"
      },
      "execution_count": 25,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "allmerge_J<- df_list_J %>% reduce(full_join, by='SEQN')\n",
        "# HSV is missing for this data set\n",
        "allmerge_J$LBXHE1 <- NA\n",
        "allmerge_J$LBXHE2 <- NA\n",
        "allmerge_J$LBDAPBSI <- NA\n",
        "allmerge_J$SSKLOTH <- NA\n",
        "allmerge_J$SSSNFL <- NA\n",
        "allmerge_J$LBXHCR <- NA\n",
        "allmerge_J$LBXHCG <- NA\n",
        "\n",
        "allmerge_J$LBXACR <- NA\n",
        "allmerge_J$LBXGLY <- NA\n",
        "allmerge_J$URXAMU <- NA\n",
        "allmerge_J$URXMU1 <- NA\n",
        "allmerge_J$URXMX1 <- NA\n",
        "allmerge_J$URXMU5 <- NA\n",
        "allmerge_J$URXMX5 <- NA\n",
        "allmerge_J$LBXTST <- NA\n",
        "allmerge_J$LBXEST <- NA\n",
        "allmerge_J$LBXHCT_SMQ <- NA\n",
        "allmerge_J$LBXCOT <- NA\n",
        "\n",
        "selected_allmerge_J <- allmerge_J[selected_columns]"
      ],
      "metadata": {
        "id": "2FRNQoUuA-HO"
      },
      "execution_count": 26,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "selected_allmerge_J <- selected_allmerge_J %>% left_join(mort_2017, by = \"SEQN\")"
      ],
      "metadata": {
        "id": "-99OC3ZSBE2D"
      },
      "execution_count": 27,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "selected_allmerge_all <- rbind(selected_allmerge_F,\n",
        "                               selected_allmerge_G,\n",
        "                               selected_allmerge_H,\n",
        "                               selected_allmerge_I,\n",
        "                               selected_allmerge_J)"
      ],
      "metadata": {
        "id": "Wwc4GcrmBG9k"
      },
      "execution_count": 28,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "selected_allmerge_all<- selected_allmerge_all %>% mutate(RACE_RECODED=recode(RIDRETH1, \"1\"=\"1\", \"2\"=\"1\", \"3\"=\"2\", \"4\"=\"3\", \"5\"=\"4\", .default=\"NA\"))"
      ],
      "metadata": {
        "id": "ELn9T6hQBIfI"
      },
      "execution_count": 29,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "selected_allmerge_all <- selected_allmerge_all %>% rowwise() %>% mutate(DRTKCAL_AVG=mean(c(DR1TKCAL,DR2TKCAL),na.rm=TRUE))\n",
        "selected_allmerge_all <- selected_allmerge_all %>% rowwise() %>% mutate(DRTTFAT_AVG =mean(c(DR1TTFAT, DR2TTFAT),na.rm=TRUE))"
      ],
      "metadata": {
        "id": "B7JaRV0iBKbb"
      },
      "execution_count": 30,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "# Calculating Body Surface Area\n",
        "selected_allmerge_all$BSA <- bsa_m2(selected_allmerge_all$BMXWT,selected_allmerge_all$BMXHT)\n",
        "\n",
        "# Calculating Sex Normalized Waist  Circumference\n",
        "selected_allmerge_all$WAISTMF <- waistMF_vec(selected_allmerge_all$BMXWAIST,selected_allmerge_all$RIAGENDR)\n",
        "\n",
        "# Calculating Estimated Plasma Volume from Strauss Formula\n",
        "selected_allmerge_all$PLASMAVOL <- plasmavol_vec(selected_allmerge_all$LBXHCT,selected_allmerge_all$LBXHGB)\n",
        "\n",
        "# Calculating Hepatic R Value\n",
        "selected_allmerge_all$RVALUE <- rvalue_vec(selected_allmerge_all$LBXSATSI,selected_allmerge_all$LBXSAPSI,selected_allmerge_all$RIDRETH3,selected_allmerge_all$RIAGENDR)\n",
        "\n",
        "# Calculating Fatty Liver Index\n",
        "selected_allmerge_all$FATTYLIVER <- fli_vec(selected_allmerge_all$LBXTR,selected_allmerge_all$BMXBMI,selected_allmerge_all$BMXWAIST,selected_allmerge_all$LBXSGTSI)\n",
        "\n",
        "# Calculating DILI Index\n",
        "selected_allmerge_all$DILI <- dili_vec(selected_allmerge_all$LBXSASSI,selected_allmerge_all$LBXSATSI,selected_allmerge_all$LBXSTB,selected_allmerge_all$RIAGENDR)\n",
        "\n",
        "# Calculating Hepatic Steatosis Index: alt,ast,bmi,diabetes,Gender\n",
        "selected_allmerge_all$HSI <- hsi_vec(selected_allmerge_all$LBXSATSI,selected_allmerge_all$LBXSASSI,selected_allmerge_all$BMXBMI,as.integer(selected_allmerge_all$DIQ010==1),selected_allmerge_all$RIAGENDR)\n",
        "\n",
        "# Calculating indexed eGFR\n",
        "selected_allmerge_all$EGFR <- eGFR_vec(selected_allmerge_all$LBXSCR, selected_allmerge_all$RIAGENDR, selected_allmerge_all$RIDAGEYR)\n",
        "\n",
        "# Calculating Systemic Inflammation Index (Hepatosteatosis effect)\n",
        "selected_allmerge_all$SII <- sii_vec(selected_allmerge_all$LBXPLTSI,selected_allmerge_all$LBDNENO,selected_allmerge_all$LBDLYMNO)\n",
        "\n",
        "# Calculating index eGFR multiplied by Body Surface area\n",
        "selected_allmerge_all$EGFRxBSA <- selected_allmerge_all$EGFR*selected_allmerge_all$BSA\n",
        "\n",
        "# Calculating Average Urine Flow from 3 measurements\n",
        "selected_allmerge_all$URDFLOW_AVG <- urineflow_vec(selected_allmerge_all$URDFLOW1,selected_allmerge_all$URDFLOW2,selected_allmerge_all$URDFLOW3)\n",
        "\n",
        "# Calculating Creatinine Clearance from Average Urine Flow, Serum Creatinine and Urine Creatinine\n",
        "selected_allmerge_all$CRCL <- creatcl_vec(selected_allmerge_all$URDFLOW_AVG,selected_allmerge_all$URXUCR,selected_allmerge_all$LBXSCR)\n",
        "\n",
        "# Calculating Serum Creatinine to Urine Creatinine Ratio\n",
        "selected_allmerge_all <- selected_allmerge_all %>% mutate(CRRATIO=LBXSCR/URXUCR)\n",
        "\n",
        "# Calculating Active Hepatitis B via Surface Antigen\n",
        "selected_allmerge_all$HEPB_sAgNew <-as.factor(hepB_sAg(selected_allmerge_all$LBXHBC,selected_allmerge_all$LBDHBG))\n",
        "\n",
        "# Calculating Hepatitis C via RNA\n",
        "selected_allmerge_all$HEPC_New <- as.factor(hepC_Recode(selected_allmerge_all$LBXHCR))\n",
        "\n",
        "# Calculating HOMA_IR and HOMA_BETA\n",
        "selected_allmerge_all$HOMA_IR <- homa_ir_vec(selected_allmerge_all$LBXGLU, selected_allmerge_all $LBXIN)\n",
        "selected_allmerge_all$HOMA_BETA <- homa_beta_vec(selected_allmerge_all$LBXGLU, selected_allmerge_all $LBXIN)\n",
        "\n",
        "selected_allmerge_all <- selected_allmerge_all %>% rowwise() %>% mutate(SBP_AVG=mean(c(BPXSY1,BPXSY2,BPXSY3,BPXSY4),na.rm=TRUE))\n",
        "selected_allmerge_all <- selected_allmerge_all %>% rowwise() %>% mutate(DBP_AVG =mean(c(BPXDI1,BPXDI2,BPXDI3,BPXDI4),na.rm=TRUE))\n"
      ],
      "metadata": {
        "id": "CvO15BAkBL9Y"
      },
      "execution_count": 31,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "lowvaluevector <- filter(selected_allmerge_all, LBXSTB>0)\n",
        "lowvalue <- min(selected_allmerge_all$LBXSTB, na.rm = TRUE)\n",
        "selected_allmerge_all$DBP_AVG <- ifelse(selected_allmerge_all$DBP_AVG==0, 0.5*lowvalue, selected_allmerge_all$DBP_AVG)"
      ],
      "metadata": {
        "id": "MrU9WUiwCH9t"
      },
      "execution_count": 32,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "# Metabolites\n",
        "selected_allmerge_all$CYP1A2 <- (selected_allmerge_all$URXAMU + selected_allmerge_all$URXMU1 + selected_allmerge_all$URXMX1)/selected_allmerge_all$URXMU5\n",
        "\n",
        "selected_allmerge_all$CYP2A6_caffiene <- selected_allmerge_all$URXMU5 / selected_allmerge_all$URXMX5\n",
        "\n",
        "selected_allmerge_all$XO <- selected_allmerge_all$URXMU1/(selected_allmerge_all$URXMX1 + selected_allmerge_all$URXMU1)\n",
        "\n",
        "selected_allmerge_all$NAT2 <- selected_allmerge_all$URXAMU /(selected_allmerge_all$URXAMU + selected_allmerge_all$URXMU1 + selected_allmerge_all$URXMX1)\n",
        "\n",
        "selected_allmerge_all$LBXCOT[selected_allmerge_all$LBXCOT < 3 ] <- NA\n",
        "\n",
        "selected_allmerge_all$CYP2A6_smoking <- (selected_allmerge_all$LBXHCT_SMQ) / selected_allmerge_all$LBXCOT\n",
        "\n",
        "selected_allmerge_all$CYP2E1 <- selected_allmerge_all$LBXACR / selected_allmerge_all$LBXGLY"
      ],
      "metadata": {
        "id": "ScNRco0pCet0"
      },
      "execution_count": 33,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "selected_allmerge_all <- selected_allmerge_all %>%\n",
        "  mutate(DiabetesYesNo=case_when(\n",
        "    DIQ010==1 ~ \"Yes\",\n",
        "    DIQ010==2 ~ \"No\",\n",
        "    DIQ010==3 ~ \"No\",\n",
        "    TRUE ~ NA_character_),\n",
        "    PreDiabetesOrDiabetesYesNo=case_when(\n",
        "      DIQ160==1 ~ \"Yes\",\n",
        "      DIQ010==3 ~ \"Yes\",\n",
        "      DIQ010==1 ~ \"Yes\",\n",
        "      DIQ160==2 ~ \"No\",\n",
        "      DIQ010==2 ~ \"No\",\n",
        "      TRUE ~ NA_character_),\n",
        "    InsulinYesNo=case_when(\n",
        "      DIQ050==1 ~ \"Yes\",\n",
        "      DIQ050==2 ~ \"No\",\n",
        "      DIQ010==2 ~ \"No\",\n",
        "      TRUE ~ NA_character_),\n",
        "    DialysisYesNo=case_when(\n",
        "      KIQ025 == 1 ~ \"Yes\",\n",
        "      KIQ025 == 2  ~ \"No\",\n",
        "      KIQ022 == 1 ~ \"No\",\n",
        "      KIQ022 == 2  ~ \"No\",\n",
        "      TRUE ~ NA_character_),\n",
        "    KidneyDiseaseYesNo=case_when(\n",
        "      KIQ022 == 1  ~ \"Yes\",\n",
        "      KIQ022 == 2  ~ \"No\",\n",
        "      TRUE ~ NA_character_),\n",
        "    HeartAttackYesNo=case_when(\n",
        "      MCQ160E == 1 ~ \"Yes\",\n",
        "      MCQ160E == 2 ~ \"No\",\n",
        "      TRUE ~ NA_character_),\n",
        "    CongestiveHeartFailureYesNo=case_when(\n",
        "      MCQ160B == 1 ~ \"Yes\",\n",
        "      MCQ160B == 2 ~ \"No\",\n",
        "      TRUE ~ NA_character_),\n",
        "    CoronaryHeartDiseaseYesNo=case_when(\n",
        "      MCQ160C == 1 ~ \"Yes\",\n",
        "      MCQ160C == 2 ~ \"No\",\n",
        "      TRUE ~ NA_character_),\n",
        "    AnginaPectorisYesNo=case_when(\n",
        "      MCQ160D == 1 ~ \"Yes\",\n",
        "      MCQ160D == 2 ~ \"No\",\n",
        "      TRUE ~ NA_character_),\n",
        "    ActiveLiverDiseaseYesNo=case_when(\n",
        "      MCQ170L == 1  ~ \"Yes\",\n",
        "      MCQ170L == 2  ~ \"No\",\n",
        "      MCQ160L == 2  ~ \"No\",\n",
        "      TRUE ~ NA_character_),\n",
        "    PastLiverDiseaseYesNo=case_when(\n",
        "      MCQ170L == 2  ~ \"Yes\",\n",
        "      MCQ160L == 2  ~ \"No\",\n",
        "      MCQ160L == 1  ~ \"No\",\n",
        "      TRUE ~ NA_character_),\n",
        "    HepatitisCYesNo=case_when(\n",
        "      HEPC_New == 1  ~ \"Yes\",\n",
        "      HEPC_New == 2   ~ \"No\",\n",
        "      MCQ170L == 1  ~ \"No\",\n",
        "      MCQ160L == 1  ~ \"No\",\n",
        "      MCQ170L == 2  ~ \"No\",\n",
        "      MCQ160L == 2  ~ \"No\",\n",
        "      TRUE ~ NA_character_),\n",
        "    HepatitisBYesNo=case_when(\n",
        "      HEPB_sAgNew == 1  ~ \"Yes\",\n",
        "      HEPB_sAgNew == 2   ~ \"No\",\n",
        "      MCQ170L == 1   ~ \"No\",\n",
        "      MCQ160L == 1   ~ \"No\",\n",
        "      MCQ170L == 2  ~ \"No\",\n",
        "      MCQ160L == 2  ~ \"No\",\n",
        "      TRUE ~ NA_character_),\n",
        "    StrokeYesNo=case_when(\n",
        "      MCQ160F ==1 ~ \"Yes\",\n",
        "      MCQ160F == 2 ~ \"No\",\n",
        "      TRUE ~ NA_character_),\n",
        "    diabetesprediabetes=case_when(\n",
        "      DIQ010==1 ~ \"Diabetes\",\n",
        "      DIQ010==3 ~ \"PreDiabetes\",\n",
        "      DIQ160== 1  ~ \"PreDiabetes\",\n",
        "      DIQ160== 2 & DIQ010 == 2 ~ \"None\",\n",
        "      TRUE ~ NA),\n",
        "    diabetes_cat=case_when(\n",
        "      DIQ050 == 1 ~ \"DiabeteswithInsulin\",\n",
        "      diabetesprediabetes ==\"Diabetes\"  ~ \"DiabetesNoInsulin\",\n",
        "      diabetesprediabetes ==\"PreDiabetes\"  ~ \"PreDiabetes\",\n",
        "      diabetesprediabetes == \"None\"  ~ \"None\",\n",
        "      TRUE ~ NA),\n",
        "    kidney_cat=case_when(\n",
        "      KIQ025 == 1 ~ \"Dialysis\",\n",
        "      KIQ022 == 1  ~ \"KidneyDisease\",\n",
        "      KIQ022 == 2  ~ \"None\",\n",
        "      TRUE ~ NA),\n",
        "    heart_cat=case_when(\n",
        "      MCQ160E == 1 ~ \"HeartAttack\",\n",
        "      MCQ160B == 1  ~ \"CHF\",\n",
        "      MCQ160C == 1  ~ \"CHD/AP\",\n",
        "      MCQ160D == 1  ~ \"CHD/AP\",\n",
        "      MCQ160C == 2 & MCQ160B == 2 & MCQ160D == 2 & MCQ160E == 2   ~ \"None\",\n",
        "      MCQ160C == 2 & MCQ160B == 2 & MCQ160E == 2   ~ \"None\",\n",
        "      TRUE ~ NA),\n",
        "    liver_cat=case_when(\n",
        "      HEPC_New == 1 ~ \"HepC\",\n",
        "      HEPB_sAgNew == 1  ~ \"HepB\",\n",
        "      MCQ170L == 1  ~ \"LiverDisease\",\n",
        "      MCQ170L == 2   ~ \"None\",\n",
        "      MCQ160L == 2   ~ \"None\",\n",
        "      TRUE ~ NA))\n",
        "\n",
        "## Changing datatype\n",
        "selected_allmerge_all$DiabetesYesNo <- as.factor(selected_allmerge_all$DiabetesYesNo)\n",
        "selected_allmerge_all$PreDiabetesOrDiabetesYesNo <- as.factor(selected_allmerge_all$PreDiabetesOrDiabetesYesNo)\n",
        "selected_allmerge_all$InsulinYesNo <- as.factor(selected_allmerge_all$InsulinYesNo)\n",
        "selected_allmerge_all$DialysisYesNo <- as.factor(selected_allmerge_all$DialysisYesNo)\n",
        "selected_allmerge_all$KidneyDiseaseYesNo <- as.factor(selected_allmerge_all$KidneyDiseaseYesNo)\n",
        "selected_allmerge_all$HeartAttackYesNo <- as.factor(selected_allmerge_all$HeartAttackYesNo)\n",
        "selected_allmerge_all$CongestiveHeartFailureYesNo <- as.factor(selected_allmerge_all$CongestiveHeartFailureYesNo)\n",
        "selected_allmerge_all$CoronaryHeartDiseaseYesNo <- as.factor(selected_allmerge_all$CoronaryHeartDiseaseYesNo)\n",
        "selected_allmerge_all$AnginaPectorisYesNo <- as.factor(selected_allmerge_all$AnginaPectorisYesNo)\n",
        "selected_allmerge_all$ActiveLiverDiseaseYesNo <- as.factor(selected_allmerge_all$ActiveLiverDiseaseYesNo)\n",
        "selected_allmerge_all$PastLiverDiseaseYesNo <- as.factor(selected_allmerge_all$PastLiverDiseaseYesNo)\n",
        "selected_allmerge_all$HepatitisCYesNo <- as.factor(selected_allmerge_all$HepatitisCYesNo)\n",
        "selected_allmerge_all$HepatitisBYesNo <- as.factor(selected_allmerge_all$HepatitisBYesNo)\n",
        "selected_allmerge_all$StrokeYesNo <- as.factor(selected_allmerge_all$StrokeYesNo)\n",
        "selected_allmerge_all$diabetes_cat <- ordered(selected_allmerge_all$diabetes_cat, levels = c(\"None\", \"PreDiabetes\", \"DiabetesNoInsulin\", \"DiabeteswithInsulin\"))\n",
        "\n",
        "selected_allmerge_all$kidney_cat <- ordered(selected_allmerge_all$kidney_cat, levels = c(\"None\", \"KidneyDisease\", \"Dialysis\"))\n",
        "\n",
        "selected_allmerge_all$heart_cat <- ordered(selected_allmerge_all$heart_cat, levels = c(\"None\", \"CHD/AP\", \"CHF\",\"HeartAttack\"))\n",
        "\n",
        "selected_allmerge_all$liver_cat <- ordered(selected_allmerge_all$liver_cat, levels = c(\"None\", \"LiverDisease\", \"HepB\",\"HepC\"))\n"
      ],
      "metadata": {
        "id": "r3GsQT_rCn3T"
      },
      "execution_count": 34,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "base_age_yr <- selected_allmerge_all$RIDAGEYR\n",
        "age_mnth <- as.numeric(selected_allmerge_all$PERMTH_INT/12)\n",
        "ifelse\n",
        "selected_allmerge_all$AGE_TOD <- ifelse(selected_allmerge_all$MORTSTAT == 1,base_age_yr + age_mnth,0)"
      ],
      "metadata": {
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 646
        },
        "id": "KgbR0-uBCvX_",
        "outputId": "c2895a03-049e-4017-f4b1-cf3a3e102c8e"
      },
      "execution_count": 36,
      "outputs": [
        {
          "output_type": "display_data",
          "data": {
            "text/html": [
              "<pre class=language-r><code>function (test, yes, no) \n",
              "{\n",
              "<span style=white-space:pre-wrap>    if (is.atomic(test)) {</span>\n",
              "<span style=white-space:pre-wrap>        if (typeof(test) != \"logical\") </span>\n",
              "<span style=white-space:pre-wrap>            storage.mode(test) &lt;- \"logical\"</span>\n",
              "<span style=white-space:pre-wrap>        if (length(test) == 1 &amp;&amp; is.null(attributes(test))) {</span>\n",
              "<span style=white-space:pre-wrap>            if (is.na(test)) </span>\n",
              "<span style=white-space:pre-wrap>                return(NA)</span>\n",
              "<span style=white-space:pre-wrap>            else if (test) {</span>\n",
              "<span style=white-space:pre-wrap>                if (length(yes) == 1) {</span>\n",
              "<span style=white-space:pre-wrap>                  yat &lt;- attributes(yes)</span>\n",
              "<span style=white-space:pre-wrap>                  if (is.null(yat) || (is.function(yes) &amp;&amp; identical(names(yat), </span>\n",
              "<span style=white-space:pre-wrap>                    \"srcref\"))) </span>\n",
              "<span style=white-space:pre-wrap>                    return(yes)</span>\n",
              "<span style=white-space:pre-wrap>                }</span>\n",
              "<span style=white-space:pre-wrap>            }</span>\n",
              "<span style=white-space:pre-wrap>            else if (length(no) == 1) {</span>\n",
              "<span style=white-space:pre-wrap>                nat &lt;- attributes(no)</span>\n",
              "<span style=white-space:pre-wrap>                if (is.null(nat) || (is.function(no) &amp;&amp; identical(names(nat), </span>\n",
              "<span style=white-space:pre-wrap>                  \"srcref\"))) </span>\n",
              "<span style=white-space:pre-wrap>                  return(no)</span>\n",
              "<span style=white-space:pre-wrap>            }</span>\n",
              "<span style=white-space:pre-wrap>        }</span>\n",
              "<span style=white-space:pre-wrap>    }</span>\n",
              "<span style=white-space:pre-wrap>    else test &lt;- if (isS4(test)) </span>\n",
              "<span style=white-space:pre-wrap>        methods::as(test, \"logical\")</span>\n",
              "<span style=white-space:pre-wrap>    else as.logical(test)</span>\n",
              "<span style=white-space:pre-wrap>    ans &lt;- test</span>\n",
              "<span style=white-space:pre-wrap>    len &lt;- length(ans)</span>\n",
              "<span style=white-space:pre-wrap>    ypos &lt;- which(test)</span>\n",
              "<span style=white-space:pre-wrap>    npos &lt;- which(!test)</span>\n",
              "<span style=white-space:pre-wrap>    if (length(ypos) &gt; 0L) </span>\n",
              "<span style=white-space:pre-wrap>        ans[ypos] &lt;- rep(yes, length.out = len)[ypos]</span>\n",
              "<span style=white-space:pre-wrap>    if (length(npos) &gt; 0L) </span>\n",
              "<span style=white-space:pre-wrap>        ans[npos] &lt;- rep(no, length.out = len)[npos]</span>\n",
              "<span style=white-space:pre-wrap>    ans</span>\n",
              "}</code></pre>"
            ],
            "text/markdown": "```r\nfunction (test, yes, no) \n{\n    if (is.atomic(test)) {\n        if (typeof(test) != \"logical\") \n            storage.mode(test) <- \"logical\"\n        if (length(test) == 1 && is.null(attributes(test))) {\n            if (is.na(test)) \n                return(NA)\n            else if (test) {\n                if (length(yes) == 1) {\n                  yat <- attributes(yes)\n                  if (is.null(yat) || (is.function(yes) && identical(names(yat), \n                    \"srcref\"))) \n                    return(yes)\n                }\n            }\n            else if (length(no) == 1) {\n                nat <- attributes(no)\n                if (is.null(nat) || (is.function(no) && identical(names(nat), \n                  \"srcref\"))) \n                  return(no)\n            }\n        }\n    }\n    else test <- if (isS4(test)) \n        methods::as(test, \"logical\")\n    else as.logical(test)\n    ans <- test\n    len <- length(ans)\n    ypos <- which(test)\n    npos <- which(!test)\n    if (length(ypos) > 0L) \n        ans[ypos] <- rep(yes, length.out = len)[ypos]\n    if (length(npos) > 0L) \n        ans[npos] <- rep(no, length.out = len)[npos]\n    ans\n}\n```",
            "text/latex": "\\begin{minted}{r}\nfunction (test, yes, no) \n\\{\n    if (is.atomic(test)) \\{\n        if (typeof(test) != \"logical\") \n            storage.mode(test) <- \"logical\"\n        if (length(test) == 1 \\&\\& is.null(attributes(test))) \\{\n            if (is.na(test)) \n                return(NA)\n            else if (test) \\{\n                if (length(yes) == 1) \\{\n                  yat <- attributes(yes)\n                  if (is.null(yat) \\textbar{}\\textbar{} (is.function(yes) \\&\\& identical(names(yat), \n                    \"srcref\"))) \n                    return(yes)\n                \\}\n            \\}\n            else if (length(no) == 1) \\{\n                nat <- attributes(no)\n                if (is.null(nat) \\textbar{}\\textbar{} (is.function(no) \\&\\& identical(names(nat), \n                  \"srcref\"))) \n                  return(no)\n            \\}\n        \\}\n    \\}\n    else test <- if (isS4(test)) \n        methods::as(test, \"logical\")\n    else as.logical(test)\n    ans <- test\n    len <- length(ans)\n    ypos <- which(test)\n    npos <- which(!test)\n    if (length(ypos) > 0L) \n        ans{[}ypos{]} <- rep(yes, length.out = len){[}ypos{]}\n    if (length(npos) > 0L) \n        ans{[}npos{]} <- rep(no, length.out = len){[}npos{]}\n    ans\n\\}\n\\end{minted}",
            "text/plain": [
              "function (test, yes, no) \n",
              "{\n",
              "    if (is.atomic(test)) {\n",
              "        if (typeof(test) != \"logical\") \n",
              "            storage.mode(test) <- \"logical\"\n",
              "        if (length(test) == 1 && is.null(attributes(test))) {\n",
              "            if (is.na(test)) \n",
              "                return(NA)\n",
              "            else if (test) {\n",
              "                if (length(yes) == 1) {\n",
              "                  yat <- attributes(yes)\n",
              "                  if (is.null(yat) || (is.function(yes) && identical(names(yat), \n",
              "                    \"srcref\"))) \n",
              "                    return(yes)\n",
              "                }\n",
              "            }\n",
              "            else if (length(no) == 1) {\n",
              "                nat <- attributes(no)\n",
              "                if (is.null(nat) || (is.function(no) && identical(names(nat), \n",
              "                  \"srcref\"))) \n",
              "                  return(no)\n",
              "            }\n",
              "        }\n",
              "    }\n",
              "    else test <- if (isS4(test)) \n",
              "        methods::as(test, \"logical\")\n",
              "    else as.logical(test)\n",
              "    ans <- test\n",
              "    len <- length(ans)\n",
              "    ypos <- which(test)\n",
              "    npos <- which(!test)\n",
              "    if (length(ypos) > 0L) \n",
              "        ans[ypos] <- rep(yes, length.out = len)[ypos]\n",
              "    if (length(npos) > 0L) \n",
              "        ans[npos] <- rep(no, length.out = len)[npos]\n",
              "    ans\n",
              "}\n",
              "<bytecode: 0x5716c1e9adf0>\n",
              "<environment: namespace:base>"
            ]
          },
          "metadata": {}
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "selected_allmerge_all <- selected_allmerge_all[selected_allmerge_all$MORTSTAT %in% c(0,1), ]"
      ],
      "metadata": {
        "id": "cVlq7Xvwb0ip"
      },
      "execution_count": 37,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "selected_allmerge_F <- selected_allmerge_F[selected_allmerge_F$MORTSTAT %in% c(0,1), ]\n",
        "selected_allmerge_G <- selected_allmerge_G[selected_allmerge_G$MORTSTAT %in% c(0,1), ]\n",
        "selected_allmerge_H <- selected_allmerge_H[selected_allmerge_H$MORTSTAT %in% c(0,1), ]\n",
        "selected_allmerge_I <- selected_allmerge_I[selected_allmerge_I$MORTSTAT %in% c(0,1), ]\n",
        "selected_allmerge_J <- selected_allmerge_J[selected_allmerge_J$MORTSTAT %in% c(0,1), ]"
      ],
      "metadata": {
        "id": "Wl-awLljb7OB"
      },
      "execution_count": 38,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "dir.create(\"/content/drive/MyDrive/PA_analysis/Datasets/\")"
      ],
      "metadata": {
        "id": "02xPC-kAckdw"
      },
      "execution_count": 40,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "# Save an object to a file\n",
        "saveRDS(selected_allmerge_F, file = \"/content/drive/MyDrive/PA_analysis/Datasets/AgingBiomarkersMR_F.rds\")\n",
        "saveRDS(selected_allmerge_G, file = \"/content/drive/MyDrive/PA_analysis/Datasets/AgingBiomarkersMR_G.rds\")\n",
        "saveRDS(selected_allmerge_H, file = \"/content/drive/MyDrive/PA_analysis/Datasets/AgingBiomarkersMR_H.rds\")\n",
        "saveRDS(selected_allmerge_I, file = \"/content/drive/MyDrive/PA_analysis/Datasets/AgingBiomarkersMR_I.rds\")\n",
        "saveRDS(selected_allmerge_J, file = \"/content/drive/MyDrive/PA_analysis/Datasets/AgingBiomarkersMR_J.rds\")\n",
        "saveRDS(selected_allmerge_all, file = \"/content/drive/MyDrive/PA_analysis/Datasets/AgingBiomarkersMR_All.rds\")\n"
      ],
      "metadata": {
        "id": "ukbJvobBb9rq"
      },
      "execution_count": 41,
      "outputs": []
    }
  ],
  "metadata": {
    "colab": {
      "provenance": [],
      "authorship_tag": "ABX9TyMZ/rFKvOJX0axeDNN8vUKv",
      "include_colab_link": true
    },
    "kernelspec": {
      "display_name": "R",
      "name": "ir"
    },
    "language_info": {
      "name": "R"
    }
  },
  "nbformat": 4,
  "nbformat_minor": 0
}